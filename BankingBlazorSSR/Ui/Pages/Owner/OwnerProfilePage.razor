@page "/owners/profile"
@using Microsoft.AspNetCore.Authorization
@using System.ComponentModel.DataAnnotations
@using BankingBlazorSsr.Api.Clients
@inherits BankingBlazorSsr.Ui.Common.BasePage

@* @attribute [Authorize] *@
@* @attribute [Authorize(Roles = "Owner")] *@


<PageTitle>Kundenprofil</PageTitle>

<div class="container py-4" style="max-width: 860px;">
    <div class="mb-3">
        <h1 class="h3 mb-1">Kundenprofil</h1>
        <div class="text-muted">
            Bitte vervollständige deine Profildaten.
        </div>
    </div>

    @if (Loading) {
        <p>Lade …</p>
    }
    else {
        <EditForm EditContext="_editContext" OnValidSubmit="SaveAsync" novalidate>
            <DataAnnotationsValidator/>

            @* Global validation *@
            @if (_showGlobalErrors) {
                <div class="alert alert-danger" role="alert">
                    <div class="fw-semibold mb-1">Eingaben prüfen</div>
                    <ValidationSummary/>
                </div>
            }

            <!-- Basisdaten -->
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h2 class="h6 text-uppercase text-muted mb-3">Basis</h2>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.Firstname" class="form-control"/>
                                <label>Vorname</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.Firstname)" class="text-danger small"/>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.Lastname" class="form-control"/>
                                <label>Nachname</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.Lastname)" class="text-danger small"/>
                        </div>

                        <div class="col-12">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.Email" class="form-control"/>
                                <label>E-Mail</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.Email)" class="text-danger small"/>
                            <div class="form-text">
                                Diese E-Mail stammt aus dem Login und kann angepasst werden.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Adresse -->
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h2 class="h6 text-uppercase text-muted mb-3">Adresse (optional)</h2>

                    <div class="row g-3">
                        <div class="col-12">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.Street" class="form-control"/>
                                <label>Straße</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.Street)" class="text-danger small"/>
                        </div>

                        <div class="col-md-4">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.PostalCode" class="form-control"/>
                                <label>PLZ</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.PostalCode)" class="text-danger small"/>
                        </div>

                        <div class="col-md-8">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.City" class="form-control"/>
                                <label>Ort</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.City)" class="text-danger small"/>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <InputText @bind-Value="_ownerDto.Country" class="form-control"/>
                                <label>Land</label>
                            </div>
                            <ValidationMessage For="@(() => _ownerDto.Country)" class="text-danger small"/>
                        </div>
                    </div>

                    <hr class="my-4"/>

                    @if (!string.IsNullOrWhiteSpace(_saveError)) {
                        <div class="alert alert-danger" role="alert">@_saveError</div>
                    }
                    @if (!string.IsNullOrWhiteSpace(_saveOk)) {
                        <div class="alert alert-success" role="alert">@_saveOk</div>
                    }

                    <div class="d-flex gap-2 justify-content-end">
                        <button type="button" class="btn btn-outline-secondary" @onclick="Cancel">
                            Abbrechen
                        </button>

                        <button type="submit" class="btn btn-primary" disabled="@_saving">
                            @(_saving ? "Speichern …" : "Speichern")
                        </button>
                    </div>
                </div>
            </div>
        </EditForm>
    }
</div>
